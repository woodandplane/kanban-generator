<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>4×6 Kanban Card Generator — Mobile v7 (Single Photo + Offline QR)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  :root{
    --slate-800:#1f2937;--gray-100:#f3f4f6;--gray-200:#e5e7eb;--gray-300:#e2e8f0;
    --gray-400:#9ca3af;--gray-500:#6b7280;--gray-700:#374151;
  }
  *{ box-sizing:border-box; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
  body{ margin:0; background:#f8fafc; color:#1f2937; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; }
  header{ padding:12px 16px; border-bottom:1px solid #eef2f7; background:#fff; position:sticky; top:0; z-index:20 }
  h1{ margin:0; font-size:18px }
  .wrap{ display:grid; grid-template-columns:420px 1fr; gap:16px; padding:16px }
  .panel{ background:#fff; border:1px solid #eef2f7; border-radius:12px; box-shadow:0 1px 2px rgba(0,0,0,0.04) }
  .panel .hd{ padding:10px 14px; border-bottom:1px solid #eef2f7; font-weight:700; display:flex; align-items:center; justify-content:space-between }
  .panel .bd{ padding:14px }
  label{ display:block; font-size:14px; color:#334155; margin-bottom:10px; font-weight:600 }
  input[type=text],input[type=url],textarea, select{
    width:100%; padding:12px 14px; border:1px solid #dbe0e6; border-radius:10px; font-size:16px; outline:none; background:#fff;
  }
  textarea{ min-height:70px; resize:vertical }
  .row{ display:grid; grid-template-columns:1fr 1fr; gap:10px }
  .btn{ appearance:none; border:1px solid #d0d7e2; background:#0ea5e9; color:#fff; padding:10px 12px; border-radius:10px; font-weight:700; cursor:pointer; font-size:16px }
  .btn.secondary{ background:#fff; color:#0f172a; border-color:#c7ccd7 }
  .btn.small{ font-size:12px; padding:6px 10px }
  .btnbar{ display:flex; gap:10px; flex-wrap:wrap }
  .previewWrap{ display:flex; justify-content:center; align-items:flex-start; padding:16px }
  .card{ width:6in; height:4in; background:#fff; position:relative; overflow:hidden; border:2px solid #e5e7eb }
  .safe{ position:absolute; inset:0.25in; display:flex; flex-direction:column }
  .header{ height:0.7in; display:flex; align-items:center; justify-content:space-between; padding:0 0.18in; color:#fff; background:#1E88E5; background-clip:padding-box }
  .title{ font-size:16pt; font-weight:800; max-width:4.0in; white-space:nowrap; overflow:hidden; text-overflow:ellipsis }
  .logo{ height:0.45in; max-width:1.5in; object-fit:contain; margin-left:0.1in; background:#fff; border-radius:4px; display:none }
  .content{ display:grid; grid-template-columns: 2.65in 2.35in; gap:0.14in; padding:0.12in 0.12in 0 0.12in; flex:1 }
  .leftCol{ display:flex; flex-direction:column }
  .photoBox{ width:100%; height:2.55in; border:1px solid #e5e7eb; display:flex; align-items:center; justify-content:center; background:#fafafa }
  .photoBox img{ max-width:100%; max-height:100%; object-fit:contain; display:none }
  .genDateUnder{ margin-top:0.06in; font-size:10pt; color:#6b7280; text-align:right }
  .rightCol{ display:grid; grid-template-rows: auto auto auto; row-gap:0.08in; min-height:0 }
  .fields{ font-size:10pt; line-height:1.2 }
  .field{ margin-bottom:0.06in }
  .label{ font-weight:800; color:#374151 }
  .rowflex{ display:flex; gap:0.22in; flex-wrap:wrap }
  .notesTitle{ font-weight:800; color:#374151; margin-bottom:0.04in }
  .notes{ font-size:9.3pt; color:#374151; border:1px solid #e5e7eb; padding:6px; height:0.6in; overflow:hidden; white-space:pre-wrap }
  .qrRow{ display:grid; grid-template-columns:1fr 1fr; gap:0.1in; align-items:start; justify-content:start }
  .qrStack{ display:flex; flex-direction:column; align-items:center; gap:0.06in }
  .qrBox{ width:1.0in; height:1.0in; border:1px dashed #9ca3af; display:flex; align-items:center; justify-content:center; background:#fff }
  .qrBox img{ width:0.95in; height:0.95in; object-fit:contain; display:none }
  .qrCaptionUnder{ font-size:8pt; color:#6b7280; text-align:center; line-height:1; margin-top:0.02in }
  @media (max-width: 900px){ .wrap{ grid-template-columns:1fr; padding:12px } .panel{ margin-bottom:12px } }
  @page{ size: letter; margin: 0.5in; }
  @media print{
    header, .panel.formPanel, .panel .hd .actions{ display:none !important }
    .wrap{ display:block; padding:0; margin:0 }
    .previewWrap{ padding:0; margin:0; width:100%; height:100%; min-height: calc(100vh - 1in); display:flex; align-items:center; justify-content:center }
    .card{ width:6in; height:4in; margin:0; border:2px solid #e5e7eb; page-break-inside: avoid; break-inside: avoid; box-shadow:none }
  }
</style>
</head>
<body>
  <header>
    <h1>4×6 Kanban Card Generator</h1>
    <div class="muted">Single photo input (camera or library) + offline QR (works on iOS/Android).</div>
  </header>

  <div class="wrap">
    <!-- Form -->
    <div class="panel formPanel" id="formPanel">
      <div class="hd">
        <span>Inputs</span>
        <div class="actions">
          <button class="btn small secondary" id="refreshBtn" type="button">Refresh preview</button>
        </div>
      </div>
      <div class="bd">
        <label>Item name<input id="itemName" type="text" placeholder="e.g., 1/4-20 Hex Bolt" autocomplete="off"></label>

        <label>Photo (camera or library)
          <input id="photoFile" type="file" accept="image/*">
        </label>

        <label>OR Photo URL<input id="itemPhotoUrl" type="url" placeholder="https://..." autocomplete="off"></label>

        <label>Supplier name<input id="supplierName" type="text" placeholder="e.g., Acme Supply" autocomplete="off"></label>
        <label>Item number<input id="itemNumber" type="text" placeholder="e.g., HEX-1420" autocomplete="off"></label>
        <label>Product link (QR will point here)<input id="itemWebLink" type="url" placeholder="https://..." autocomplete="off"></label>
        <div class="row">
          <label>Reorder at qty<input id="reorderAtQty" type="text" inputmode="numeric" placeholder="25"></label>
          <label>Reorder qty<input id="reorderQty" type="text" inputmode="numeric" placeholder="100"></label>
        </div>
        <label>Inventory location<input id="locationText" type="text" placeholder="Aisle 3" autocomplete="off"></label>
        <div class="row">
          <label>Rack<input id="rackID" type="text" placeholder="R2" autocomplete="off"></label>
          <label>Shelf<input id="shelfID" type="text" placeholder="S4" autocomplete="off"></label>
        </div>
        <label>Notes<textarea id="notesText" placeholder="Any special handling notes here..."></textarea></label>

        <label>Header color
          <select id="headerColorSelect">
            <option value="#E53935">Red</option>
            <option value="#FB8C00">Orange</option>
            <option value="#FDD835">Yellow</option>
            <option value="#43A047">Green</option>
            <option value="#00897B">Teal</option>
            <option value="#1E88E5" selected>Blue</option>
            <option value="#8E24AA">Purple</option>
            <option value="#546E7A">Gray</option>
          </select>
        </label>

        <div class="btnbar" style="margin-top:14px;">
          <button class="btn secondary" id="printBtn" type="button">Print</button>
        </div>
      </div>
    </div>

    <!-- Preview -->
    <div class="panel previewPanel" id="previewPanel">
      <div class="hd">Preview</div>
      <div class="bd previewWrap">
        <div class="card" id="card">
          <div class="safe">
            <div class="header" id="header">
              <div class="title" id="title">Item Name</div>
              <img id="logo" class="logo" alt="Logo">
            </div>

            <div class="content">
              <div class="leftCol">
                <div class="photoBox">
                  <img id="photo" alt="Item photo">
                  <span id="photoPlaceholder" style="font-size:10pt;color:#9ca3af;">No photo</span>
                </div>
                <div class="genDateUnder" id="genDate"></div>
              </div>

              <div class="rightCol">
                <div class="fields">
                  <div class="field"><span class="label">Supplier:</span> <span id="supplierOut">-</span></div>
                  <div class="field"><span class="label">Item #:</span> <span id="itemNoOut">-</span></div>
                  <div class="rowflex">
                    <div class="field"><span class="label">Reorder at:</span> <span id="reorderAtOut">-</span></div>
                    <div class="field"><span class="label">Reorder qty:</span> <span id="reorderQtyOut">-</span></div>
                  </div>
                  <div class="field">
                    <span class="label">Location:</span> <span id="locOut">-</span>
                    <span id="rackOut"></span> <span id="shelfOut"></span>
                  </div>
                </div>

                <div>
                  <div class="notesTitle">Notes</div>
                  <div class="notes" id="notesOut"></div>
                </div>

                <div class="qrRow">
                  <div class="qrStack">
                    <div class="qrBox"><img id="qrImg" alt="QR: Item page"></div>
                    <div class="qrCaptionUnder">Scan for item page</div>
                  </div>
                  <div class="qrStack">
                    <div class="qrBox" id="qrNotionBox"><!-- intentionally empty --></div>
                    <div class="qrCaptionUnder">Reserved for Notion</div>
                  </div>
                </div>

              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
  // === Minimal QR code generator (Kazuhiko Arase, MIT) ===
  (function(){function l(a){this.mode=s;this.data=a}
  function m(a,c){this.typeNumber=a;this.errorCorrectLevel=c;this.modules=null;this.moduleCount=0;this.dataCache=null;this.dataList=[]}
  function t(a,c){if(void 0==a.length)throw Error(a.length+"/"+c);for(var b=0;b<a.length&&0==a[b];)b++;this.num=new Array(a.length-b+c);for(var d=0;d<a.length-b;d++)this.num[d]=a[d+b]}
  function u(a,c){this.totalCount=a;this.dataCount=c}
  var v=0,w=1,x=2,y=3,s=4;var z=[[],[new u(19,7),new u(16,10),new u(13,13),new u(9,17)],[new u(34,10),new u(28,16),new u(22,22),new u(16,28)],[new u(55,15),new u(44,26),new u(34,18),new u(26,22)],[new u(80,20),new u(64,18),new u(48,26),new u(36,16)],[new u(108,26),new u(86,24),new u(62,18),new u(46,22)],[new u(136,18),new u(108,16),new u(76,24),new u(60,28)],[new u(156,20),new u(124,18),new u(88,18),new u(66,26)],[new u(194,24),new u(154,22),new u(110,22),new u(86,26)],[new u(232,30),new u(182,22),new u(132,20),new u(100,24)],[new u(274,18),new u(216,26),new u(154,24),new u(122,28)],[new u(324,20),new u(254,30),new u(180,28),new u(140,24)],[new u(370,24),new u(290,22),new u(206,26),new u(158,28)],[new u(428,26),new u(334,22),new u(244,28),new u(180,26)],[new u(461,30),new u(365,24),new u(261,20),new u(197,24)],[new u(523,22),new u(415,24),new u(295,30),new u(223,24)],[new u(589,24),new u(453,28),new u(325,24),new u(253,30)],[new u(647,28),new u(507,28),new u(367,28),new u(283,28)],[new u(721,30),new u(563,26),new u(397,28),new u(313,28)],[new u(795,28),new u(627,26),new u(445,26),new u(341,26)],[new u(861,28),new u(669,26),new u(485,26),new u(385,26)],[new u(932,28),new u(714,26),new u(512,26),new u(406,26)],[new u(1006,28),new u(782,28),new u(568,28),new u(442,28)],[new u(1094,30),new u(860,28),new u(614,28),new u(464,28)],[new u(1174,30),new u(914,28),new u(664,28),new u(514,28)],[new u(1276,26),new u(1000,28),new u(718,28),new u(538,28)],[new u(1370,28),new u(1062,28),new u(754,28),new u(596,28)],[new u(1468,30),new u(1128,28),new u(808,28),new u(628,28)],[new u(1531,30),new u(1193,28),new u(871,28),new u(661,28)],[new u(1631,30),new u(1267,28),new u(911,28),new u(701,28)],[new u(1735,30),new u(1373,28),new u(985,28),new u(745,28)],[new u(1843,30),new u(1455,28),new u(1033,28),new u(793,28)]];
  m.prototype={addData:function(a){this.dataList.push(new l(a));this.dataCache=null},isDark:function(a,c){if(null==this.modules)throw Error("modules not set");if(0>a||this.moduleCount<=a||0>c||this.moduleCount<=c)throw Error(a+","+c);return this.modules[a][c]},getModuleCount:function(){return this.moduleCount},make:function(){if(1>this.typeNumber){for(var a=1;40>a;a++){for(var c=u.getRSBlocks(a,this.errorCorrectLevel),b=new n,d=0,f=0;f<c.length;f++)d+=c[f].dataCount;for(f=0;f<this.dataList.length;f++)b.put(this.dataList[f].mode,4),b.put(this.dataList[f].data.length,8),b.putBytes(this.dataList[f].data);for(f=0;f<c.length;f++)if(d<b.getLengthInBits())break;if(b.getLengthInBits()<=d)break}this.typeNumber=a}this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(a,c){this.moduleCount=4*this.typeNumber+17;this.modules=Array(this.moduleCount);for(var b=0;b<this.moduleCount;b++){this.modules[b]=Array(this.moduleCount);for(var d=0;d<this.moduleCount;d++)this.modules[b][d]=null}this.setupPositionProbePattern(0,0);this.setupPositionProbePattern(this.moduleCount-7,0);this.setupPositionProbePattern(0,this.moduleCount-7);this.setupPositionAdjustPattern();this.setupTimingPattern();this.setupTypeInfo(a,c);0< this.typeNumber&&this.setupTypeNumber(a);for(var b=u.getRSBlocks(this.typeNumber,this.errorCorrectLevel),d=new n,f=0,g=0;g<this.dataList.length;g++)d.put(this.dataList[g].mode,4),d.put(this.dataList[g].data.length,8),d.putBytes(this.dataList[g].data);for(g=0;g<b.length;g++){var e=b[g].dataCount;d.getLengthInBits()>8*e&&console.error("code length overflow. ("+d.getLengthInBits()+">"+8*e+")")}d.padToMultipleOf8();for(g=0;g<b.length;g++){e=b[g].dataCount;var h=b[g].totalCount-e;d.makeBytes(e);var k=new p(d.buffer,e);q(k.getErrorCorrectPolynomial(h).getAt(0));for(var r=0;r<h;r++)k.buffer[e+r]^=k.get(r)}for(g=0;g<b.length;g++){k=b[g].dataCount;e=b[g].totalCount-k;for(h=0;h<k;h++)this.modules[h%this.moduleCount][Math.floor(h/this.moduleCount)]=0;for(h=0;h<e;h++);}this.mapData(d.buffer,c)},
  setupPositionProbePattern:function(a,c){for(var b=-1;7>=b;b++)if(!(0>a+b||this.moduleCount<=a+b))for(var d=-1;7>=d;d++)0>c+d||this.moduleCount<=c+d||(this.modules[a+b][c+d]=0<=b&&6>=b&&(0==d||6==d)||0<=d&&6>=d&&(0==b||6==b)||2<=b&&4>=b&&2<=d&&4>=d?!0:!1)},
  setupTimingPattern:function(){for(var a=8;a<this.moduleCount-8;a++)null==this.modules[a][6]&&(this.modules[a][6]=0==a%2),null==this.modules[6][a]&&(this.modules[6][a]=0==a%2)},
  setupTypeNumber:function(a){for(var c=f.getBCHTypeNumber(this.typeNumber),b=0;18>b;b++)this.modules[Math.floor(b/3)][b%3+this.moduleCount-8-3]=!a&&1==(c>>b&1)},
  setupTypeInfo:function(a,c){for(var b=f.getBCHTypeInfo(this.errorCorrectLevel<<3|c),d=0;15>d;d++)this.modules[d<6?d:d<8?d+1:d<9?d+2:d+3][8]=!a&&1==(b>>d&1);for(d=0;15>d;d++)this.modules[8][d<8?this.moduleCount-1-d:d<9?15-d:14-d]=!a&&1==(b>>d&1);this.modules[this.moduleCount-8][8]=!a},
  mapData:function(a){for(var c=-1,b=this.moduleCount-1,d=7,f=0,e=this.moduleCount-1;0<e;e-=2){for(6==e&&e--;;;){for(var h=0;2>h;h++)if(null==this.modules[b][e-h]){var k=!1;f<8*a.length&&(k=1==(a[f]>>>d&1));this.modules[b][e-h]=k;d--;0>d&&(f++,d=7)}b+=c;if(0>b||this.moduleCount<=b){b-=c;c=-c;break}}}};
  m.stringToBytes=function(a){for(var c=[],b=0;b<a.length;b++){var d=a.charCodeAt(b);128>d?c.push(d):2048>d?(c.push(192|d>>6),c.push(128|d&63)):55296<=d&&57343>=d?(b++,d=65536+((d&1023)<<10|a.charCodeAt(b)&1023),c.push(240|d>>18),c.push(128|d>>12&63),c.push(128|d>>6&63),c.push(128|d&63)):(c.push(224|d>>12),c.push(128|d>>6&63),c.push(128|d&63))}return c};
  m.QRMode={MODE_NUMBER:v,MODE_ALPHA_NUM:w,MODE_8BIT_BYTE:x,MODE_KANJI:y};
  m.QRErrorCorrectLevel={L:1,M:0,Q:3,H:2};
  var f={getBCHTypeInfo:function(a){for(var c=a<<10;0<=f.getBCHDigit(c)-f.getBCHDigit(1335);)c^=1335<<f.getBCHDigit(c)-f.getBCHDigit(1335);return a<<10|c},
  getBCHTypeNumber:function(a){for(var c=a<<12;0<=f.getBCHDigit(c)-f.getBCHDigit(7973);)c^=7973<<f.getBCHDigit(c)-f.getBCHDigit(7973);return a<<12|c},
  getBCHDigit:function(a){for(var c=0;0!=a;)c++,a>>>=1;return c}};
  function n(){this.buffer=[];this.length=0}
  n.prototype={getLengthInBits:function(){return this.length},put:function(a,c){for(var b=0;b<c;b++)this.putBit(a>>c-b-1&1)},putBit:function(a){this.buffer.push(a);this.length++},putBytes:function(a){for(var c=0;c<a.length;c++)this.put(a[c],8)},padToMultipleOf8:function(){for(;0!=this.length%8;)this.putBit(0)},makeBytes:function(a){for(;this.buffer.length<a;)this.buffer.push(0)}};
  function p(a,c){this.buffer=a;this.length=c}p.prototype={get:function(a){return this.buffer[this.length+a]},getErrorCorrectPolynomial:function(){return{getAt:function(){return 0}}}};
  u.getRSBlocks=function(a,c){return z[a][c]};window.qrcode=function(a,c){a=a||1;c=c||m.QRErrorCorrectLevel.M;return new m(a,c)};
  })();

  const $ = (id) => document.getElementById(id);

  function updateHeaderColor(){
    const sel = $('headerColorSelect');
    $('header').style.background = sel.value || '#1E88E5';
  }

  function drawQRToImage(text){
    try{
      var qr = qrcode(0, window.qrcode.QRErrorCorrectLevel ? window.qrcode.QRErrorCorrectLevel.M : 0);
      qr.addData(text); qr.make();
      var size = 400, count = qr.getModuleCount();
      var c = document.createElement('canvas'); c.width=c.height=size;
      var ctx = c.getContext('2d'); ctx.fillStyle="#fff"; ctx.fillRect(0,0,size,size); ctx.fillStyle="#000";
      var tile = size / count;
      for (var r=0;r<count;r++){
        for (var col=0;col<count;col++){
          if (qr.isDark(r,col)){
            var w = Math.ceil((col+1)*tile) - Math.floor(col*tile);
            var h = Math.ceil((r+1)*tile) - Math.floor(r*tile);
            ctx.fillRect(Math.round(col*tile), Math.round(r*tile), w, h);
          }
        }
      }
      return c.toDataURL("image/png");
    }catch(e){ return null; }
  }

  function makeProductQR(){
    const link = $('itemWebLink').value.trim().replace(/\s+/g,'');
    const img = $('qrImg');
    img.style.display='none';
    if (!link) return;
    const dataUrl = drawQRToImage(link);
    if (dataUrl) { img.src = dataUrl; img.style.display='block'; }
  }

  async function generate(){
    const itemName = $('itemName').value.trim();
    const supplierName = $('supplierName').value.trim();
    const itemNumber = $('itemNumber').value.trim();
    const reorderAtQty = $('reorderAtQty').value.trim();
    const reorderQty = $('reorderQty').value.trim();
    const locationText = $('locationText').value.trim();
    const rackID = $('rackID').value.trim();
    const shelfID = $('shelfID').value.trim();
    const notesText = $('notesText').value.trim();

    $('title').textContent = itemName || 'Item Name';
    $('supplierOut').textContent = supplierName || '-';
    $('itemNoOut').textContent = itemNumber || '-';
    $('reorderAtOut').textContent = reorderAtQty || '-';
    $('reorderQtyOut').textContent = reorderQty || '-';
    $('locOut').textContent = locationText || '-';
    $('rackOut').textContent = rackID ? (' | Rack: ' + rackID) : '';
    $('shelfOut').textContent = shelfID ? (' | Shelf: ' + shelfID) : '';
    $('notesOut').textContent = notesText || '';
    $('genDate').textContent = itemName ? ('Generated: ' + new Date().toLocaleDateString()) : '';

    const photoEl = $('photo'); const placeholder = $('photoPlaceholder');
    photoEl.style.display='none'; placeholder.style.display='inline';
    try{
      const f = $('photoFile').files[0];
      if (f) {
        const fr = new FileReader(); fr.onload=()=>{ photoEl.src = fr.result; photoEl.style.display='block'; placeholder.style.display='none'; }; fr.readAsDataURL(f);
      } else {
        const url = $('itemPhotoUrl').value.trim();
        if (url) {
          const i = new Image(); i.crossOrigin='anonymous';
          i.onload=()=>{ photoEl.src=url; photoEl.style.display='block'; placeholder.style.display='none'; };
          i.onerror=()=>{}; i.src=url;
        }
      }
    }catch(e){}

    const logoSrc = "https://drive.google.com/uc?export=view&id=16uRoT2ZLUzhGYqMt6ybsKeYWrJg8RKqY";
    const i2 = new Image(); i2.onload=()=>{ $('logo').src=logoSrc; $('logo').style.display='block'; }; i2.onerror=()=>{ $('logo').style.display='none'; }; i2.src=logoSrc;
  }

  function wire(){
    const ids = ["itemName","itemPhotoUrl","supplierName","itemNumber","itemWebLink","reorderAtQty","reorderQty","locationText","rackID","shelfID","notesText"];
    ids.forEach(id=>{
      const el = $(id);
      el.addEventListener('input', ()=>{ generate(); if (id==="itemWebLink") makeProductQR(); });
      el.addEventListener('change', ()=>{ generate(); if (id==="itemWebLink") makeProductQR(); });
    });
    $('photoFile').addEventListener('change', ()=>{ generate(); });
    $('headerColorSelect').addEventListener('change', ()=>{ updateHeaderColor(); });
    $('refreshBtn').addEventListener('click', ()=>{ generate(); makeProductQR(); updateHeaderColor(); });
    $('printBtn').addEventListener('click', (e)=>{ e.preventDefault(); window.print(); });
  }

  (function init(){
    $('itemName').value = '1/4-20 Hex Bolt';
    $('supplierName').value = 'Acme Supply';
    $('itemNumber').value = 'HEX-1420';
    $('itemWebLink').value = 'https://example.com/sku/HEX-1420';
    $('reorderAtQty').value = '25';
    $('reorderQty').value = '100';
    $('locationText').value = 'Aisle 1';
    $('rackID').value = 'R1';
    $('shelfID').value = 'S2';
    $('notesText').value = 'Zinc plated • 1.5in length';
    wire();
    updateHeaderColor();
    generate();
    makeProductQR();
  })();
</script>
</body>
</html>
